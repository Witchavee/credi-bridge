<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Credi-Bridge OCR Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
      body { font-family: Arial, sans-serif; margin: 40px; background: #f6f6fa; }
      .container { max-width: 520px; margin: auto; background: #fff; padding: 24px; border-radius: 10px; box-shadow: 0 2px 8px #ddd; }
      h2 { color: #4466aa; }
      input[type="file"] { margin: 10px 0; }
      button { background: #4466aa; color: white; border: none; padding: 10px 16px; font-size: 1em; border-radius: 5px; cursor: pointer; }
      button:hover { background: #223388;}
      #result { margin-top: 30px; background: #f1f1f8; padding: 18px; border-radius: 8px; }
      .loading { color: #ff9800; }
      .error { color: #d32f2f; }
      .ocr-text { color: #006400; font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <h2>อ่านข้อความด้วย AI OCR</h2>
    <form id="ocrForm">
      <label>เลือกรูปภาพสำหรับวิเคราะห์ OCR:</label><br>
      <input type="file" id="imageFile" name="imageFile" accept="image/*" required><br>
      <button type="submit">วิเคราะห์ภาพ</button>
    </form>

    <div id="result"></div>
  </div>

  <script>
    const ocrForm = document.getElementById('ocrForm');
    const resultDiv = document.getElementById('result');

    ocrForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      resultDiv.innerHTML = '<span class="loading">กำลังวิเคราะห์ภาพ...</span>';

      const formData = new FormData();
      const imageFile = document.getElementById('imageFile').files[0];
      formData.append('imageFile', imageFile);

      try {
        const res = await fetch('/api/analyze-image', {
          method: 'POST',
          body: formData
        });
        const data = await res.json();

        if (res.ok && data.ocrData) {
          let text = data.ocrData.words_block_list
            ? data.ocrData.words_block_list.map(b => b.words).join('<br>')
            : '(ไม่มีข้อมูลที่อ่านได้)';
          resultDiv.innerHTML = `<div class="ocr-text">ผล OCR:</div><div>${text}</div>`;
        } else {
          resultDiv.innerHTML = `<span class="error">เกิดข้อผิดพลาด: ${data.message || 'ไม่สามารถอ่านภาพได้'}</span>`;
        }
      } catch (err) {
        resultDiv.innerHTML = `<span class="error">เกิดข้อผิดพลาดขณะติดต่อ API</span>`;
      }
    });
  </script>
</body>
</html>
